# 拖动标签确认功能说明

## 功能概述

在分析页面 (http://localhost:8082/analysis) 中，为节拍标签的拖动操作添加了确认机制，避免误操作。

## 使用流程

### 1. 拖动标签
- 用鼠标拖动任意红色节拍标签到新位置
- 松开鼠标后，标签不会立即移动

### 2. 预览模式
拖动结束后：
- **原标签**：保持在原位置，颜色变为**灰色**，且不可拖动
- **预览标签**：在新位置显示**绿色**标签，标注"(点击确认)"

### 3. 确认移动
有两种方式确认或取消：

#### 方式一：左键点击预览标签
- 点击绿色预览标签
- 弹出确认对话框，显示移动信息
- 点击"确认"：应用移动，原标签移到新位置并恢复红色
- 点击"取消"：取消移动，原标签恢复红色和可拖动状态，预览标签消失

#### 方式二：右键点击预览标签
- 右键点击绿色预览标签
- 弹出右键菜单
- 选择"取消移动"：直接取消操作，恢复原状态

### 4. 保存修改
- 确认移动后，记得点击"保存节拍修改"按钮保存到数据库

## 注意事项

1. **预览模式下的限制**：
   - 灰色的原标签不可拖动
   - 右键点击灰色原标签会提示"请先确认或取消当前的移动操作"
   - 绿色预览标签不可拖动，只能点击确认或取消

2. **多次拖动**：
   - 如果在确认前拖动其他标签，会自动清理之前的预览状态
   - 建议每次只操作一个标签，确认后再操作下一个

3. **操作历史**：
   - 确认移动后，操作会被记录到历史中
   - 可以使用 Ctrl+Z 撤回操作

## 相关功能

- **键盘移动**：右键点击标签 → 选择"键盘移动"，使用左右方向键精确移动（每次0.01s）
- **删除标签**：右键点击标签 → 选择"删除"
- **双击添加**：双击波形图任意位置添加新节拍点
- **快捷键添加**：播放时按 W/A/S/D 键在当前播放位置添加节拍点

## 技术实现

- 原标签颜色：`rgba(255, 0, 0, 0.6)` (红色)
- 预览模式原标签：`rgba(128, 128, 128, 0.3)` (灰色)
- 预览标签颜色：`rgba(0, 200, 0, 0.6)` (绿色)









